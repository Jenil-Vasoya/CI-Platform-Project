@model CIPlatform.Entities.ViewModel.VolunteerTimeSheet


@if (TempData["SheetSuccess"] != null)
{

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>

    <script type="text/javascript">
        toastr.options = {
            "closeButton": true,
            "progressBar": true
        }
        toastr.success('@TempData["SheetSuccess"]', { timeOut: 10 })
    </script>

}

@if (TempData["SheetEditSuccess"] != null)
{

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>

    <script type="text/javascript">
        toastr.options = {
            "closeButton": true,
            "progressBar": true
        }
        toastr.success('@TempData["SheetEditSuccess"]', { timeOut: 10 })
    </script>

}

@if (TempData["SheetDelete"] != null)
{

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>

    <script type="text/javascript">
        toastr.options = {
            "closeButton": true,
            "progressBar": true
        }
        toastr.error('@TempData["SheetDelete"]', { timeOut: 10 })
    </script>

}


<style>

    .applyButton {
        border: 2px solid #F88634;
        border-radius: 100px;
        color: #F88634;
        background-color: white;
        padding-left: 20px;
        padding-right: 20px;
    }

        .applyButton:hover {
            background-color: #F88634;
            color: white;
        }

    table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
    }

        table tbody {
            display: table;
            width: 100%;
        }

    table, tr, td, th {
        padding: 10px;
        margin: auto;
        border: none;
    }

    .profile-nav {
        width: 40px;
        height: 40px;
        border-radius: 50%;
    }

    .nav-item {
        list-style-type: None;
    }

    .profile {
        width: 40px;
        height: 40px;
        border-radius: 50%;
    }
</style>


<partial name="_FirstNav" />

<div class="container">
    <h2 class="mb-4 mt-4">Volunteering Timesheet</h2>
    <div class="row">
        <div class="col-lg-6">
            <div class="container">
                <div class="border">
                    <div class="container">
                        <div class="row mt-4">
                            <div class="col-6">
                                <h6>Volunteering Hours</h6>
                            </div>
                            <div class="col-6 d-flex justify-content-end">

                                <input type="hidden" asp-for="UserId" />

                                <button type="button" class="btn applyButton rounded-pill" data-bs-toggle="modal" data-bs-target="#exampleModal12">
                                    <i class="bi bi-plus"></i>
                                    Add
                                </button>

                                <!-- Modal For ADD Hours -->
                                <div class="modal fade" id="exampleModal12" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">

                                    <div class="modal-dialog modal-dialog-centered">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h1 class="modal-title fs-5" id="exampleModalLabel">
                                                    Please input below Volunteering Hours
                                                </h1>
                                                <button type="button" class="btn-close" onclick="clearSheet()" data-bs-dismiss="modal"
                                                        aria-label="Close"></button>
                                            </div>


                                            <form method="post">
                                                <div class="modal-body">

                                                <label asp-for="MissionId" class="mb-1 ">Mission</label>
                                                <select id="missionId" name="missionId" asp-for="MissionId" class="form-control form-select" required>
                                                <option >Select your mission</option>
                                                @foreach (var obj in ViewBag.MissionList)
                                                {
                                                if (obj.MissionType == "Time")
                                                {
                                                <option value="@obj.MissionId">@obj.Title</option>
                                                }
                                                }
                                                </select>

                                                <label asp-for="DateVolunteered" class="mb-1 mt-3">Date</label>

                                                <div class="form-group">
                                                <input type="date" asp-for="sendDateVolunteered" id="dateVolunteered" name="dateVolunteered" class="form-control" oninput="validDate()" required>
                                                                            <span asp-validation-for="sendDateVolunteered" style="color:red"></span>

                                                </div>
                                                <div class="row">
                                                <div class="col-6">
                                                <label class="mb-1 mt-3">Hours</label>
                                                <input type="text" asp-for="Hours" id="hours" class="form-control" placeholder="Enter Spent Hours">
                                                                            <span asp-validation-for="Hours" style="color:red"></span>

                                                </div>
                                                <div class="col-6">
                                                <label class="mb-1 mt-3">
                                                Minute
                                                </label>
                                                <input type="text" asp-for="Minutes" id="minutes" class="form-control" placeholder="Enter Spent Minutes">
                                                                            <span asp-validation-for="Minutes" style="color:red"></span>

                                                </div>
                                                </div>

                                                <label class="mb-1 mt-3" for="exampleFormControlTextarea1">Message</label>
                                                <textarea class="form-control" asp-for="Notes" id="exampleFormControlTextarea1" rows="4" placeholder="Enter your message..."></textarea>
                                                                            <span asp-validation-for="Notes" style="color:red"></span>


                                                </div>
                                                <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary bg-transparent border border-2 rounded-pill text-secondary"  onclick="clearSheet()" data-bs-dismiss="modal">Cancel</button>
                                                <button type="submit" asp-controller="User" asp-action="AddTimeSheet" class="btn applyButton">Submit</button>
                                                </div>
                                                </form>
                                        </div>
                                    </div>
                                </div>

                            </div>

                        </div>
                        <table class="table ">
                            <tbody>
                                <tr class=" mt-3 mb-3">

                                    <th scope="col"><b>Mission</b> </th>
                                    <th scope="col"><b>Date</b> </th>
                                    <th scope="col"><b>Hours</b> </th>
                                    <th scope="col"> <b>Minutes</b> </th>
                                    <th scope="col"></th>
                                </tr>
                              
                                @foreach (var obj in ViewBag.SheetData)
                                {
                                    if (obj.Time != "")
                                    {
                                        <tr class=" mt-3 mb-3">
                                            <td scope="col">@obj.MissionTitle</td>
                                            <td scope="col">@obj.DateVolunteered</td>
                                            <td scope="col">@obj.Hours.ToString()</td>
                                            <td scope="col">@obj.Minutes.ToString()</td>
                                            <td scope="col">
                                                <button type="button" class="btn p-0"  data-bs-toggle="modal" data-bs-target="#exampleModal11-@obj.TimesheetId">
                                                    <i class="bi bi-pencil-square" style="color: coral;"></i>
                                                </button>

                                                <!-- Modal For Edit Hours -->
                                                    <div class="modal fade" id="exampleModal11-@obj.TimesheetId" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                        
                                                        <div class="modal-dialog modal-dialog-centered">
                                                            <div class="modal-content">

                                                                <div class="modal-header">
                                                                    <h1 class="modal-title fs-5" id="exampleModalLabel">
                                                                        Please input below Volunteering Hours
                                                                    </h1>
                                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                </div>
                                                                <form method="post">
                                                                    <input type="hidden" value="@obj.TimesheetId" asp-for="TimesheetId" />
                                                                    <div class="modal-body">

                                                                        <label class="mb-1 ">Mission</label>
                                                                        <select asp-for="MissionId" class="form-select" data-bs-toggle="dropdown" aria-placeholder="dropdown" required>
                                                                            <option selected value="@obj.MissionId">@obj.MissionTitle</option>
                                                                            @foreach (var obj1 in ViewBag.MissionList)
                                                                            {
                                                                                if (obj1.MissionType == "Time" && obj1.MissionId != obj.MissionId)
                                                                                {
                                                                                    <option value="@obj1.MissionId">@obj1.Title</option>
                                                                                }
                                                                            }
                                                                        </select>
                                                                        <label class="mb-1 mt-3">
                                                                            Date
                                                                        </label>

                                                                        <div class="form-group">
                                                                            <input type="date" name="sendDateVolunteered" oninput="checkDate()" value="@obj.DateVolunteered" class="form-control">
                                                                            <span asp-validation-for="sendDateVolunteered" style="color:red"></span>

                                                                        </div>
                                                                        <div class="row">
                                                                            <div class="col-6">
                                                                                <label class="mb-1 mt-3">Hours</label>
                                                                                <input type="text" asp-for="Hours" value="@obj.Hours" class="form-control" placeholder="Enter Spent Hours">
                                                                            <span asp-validation-for="Hours" style="color:red"></span>

                                                                            </div>
                                                                            <div class="col-6">
                                                                                <label class="mb-1 mt-3">
                                                                                    Minute
                                                                                </label>
                                                                                <input type="text" asp-for="Minutes" value="@obj.Minutes"  class="form-control" placeholder="Enter Spent Minutes">
                                                                            <span asp-validation-for="Minutes" style="color:red"></span>
                                                                            
                                                                            </div>
                                                                        </div>

                                                                        <label class="mb-1 mt-3" for="exampleFormControlTextarea1">Message</label>
                                                                        <textarea class="form-control" name="Notes" id="exampleFormControlTextarea1"  rows="4" placeholder="Enter your message...">@obj.Notes</textarea>
                                                                            <span asp-validation-for="Notes" style="color:red"></span>

                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary bg-transparent border border-2 rounded-pill text-secondary" data-bs-dismiss="modal">Cancel</button>
                                                                        <button type="submit" asp-controller="User" asp-action="EditTimeSheet" class="btn applyButton">Submit</button>
                                                                    </div>
                                                                </form>
          
                                                            </div>
                                                        </div>
                                                    </div>

                                                <button type="button" class="btn p-0" data-bs-toggle="modal" data-bs-target="#exampleModalDeleteTime-@obj.TimesheetId">
                                                    <i class="bi bi-trash ms-3"></i>
                                                </button>

                                                <!-- Modal For Delete Hours -->
                                                    <div class="modal fade" id="exampleModalDeleteTime-@obj.TimesheetId" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">

                                                        <div class="modal-dialog modal-dialog-centered">
                                                            <div class="modal-content">
                                                                <div class="modal-header">
                                                                    <h1 class="modal-title fs-5" id="exampleModalLabel">
                                                                        Are you sure for delete this TimeSheet
                                                                    </h1>
                                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                </div>

                                                                <form method="post">

                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary bg-transparent border border-2 rounded-pill text-secondary" data-bs-dismiss="modal">Cancel</button>
                                                                        <button type="submit" asp-route-id="@obj.TimesheetId" asp-controller="User" asp-action="DeleteTimeSheet" class="btn applyButton">Delete</button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>

                                            </td>

                                        </tr>
                                    }
                                }
                                
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>


        <div class="col-lg-6 mt-lg-0 mt-3">
            <div class="container">
                <div class="border">
                    <div class="container">
                        <div class="row mt-4">
                            <div class="col-6">
                                <h6>Volunteering Goals</h6>
                            </div>
                            <div class="col-6 d-flex justify-content-end">
                                <button type="button" class="btn applyButton rounded-pill" data-bs-toggle="modal" data-bs-target="#exampleModal">
                                    <i class="bi bi-plus"></i>
                                    Add
                                </button>

                                <!-- Modal For Add Goal -->
                                    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">

                                        <div class="modal-dialog modal-dialog-centered">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h1 class="modal-title fs-5" id="exampleModalLabel">
                                                        Please input
                                                        below Volunteering Goal
                                                    </h1>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" onclick="clearSheet()" aria-label="Close"></button>
                                                </div>

                                                <form method="post">
                                                <div class="modal-body">

                                                    <label class="mb-1 ">Mission</label>
                                                    <select id="missionId2" name="missionId" asp-for="MissionId" class="form-control form-select">
                                                <option >Select your mission</option>
                                                         @foreach (var obj in ViewBag.MissionList)
                                                            {
                                                                if (obj.MissionType == "Goal")
                                                                {
                                                                    <option value="@obj.MissionId">@obj.Title</option>
                                                                }
                                                            }
                                                    </select>
                                                    <label class="mb-1 mt-3">Actions</label>
                                                    <input type="text" asp-for="Action" id="action" class="form-control" placeholder="Enter Actions">
                                                     <span asp-validation-for="Action" style="color:red"></span>

                                                    

                                                    <div class="form-group">
                                                        <label class="mb-1 mt-3">
                                                        Date
                                                    </label>
                                                        <input type="date" asp-for="sendDateVolunteered" id="dateVolunteered2" name="dateVolunteered" class="form-control" required>
                                                                            <span asp-validation-for="sendDateVolunteered" style="color:red"></span>

                                                    </div>

                                                    <label class="mb-1 mt-3" for="exampleFormControlTextarea1">Message</label>
                                                    <textarea class="form-control" asp-for="Notes" id="exampleFormControlTextarea12" rows="4" placeholder="Enter your message..."></textarea>
                                                                            <span asp-validation-for="Notes" style="color:red"></span>

                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary bg-transparent border border-2 rounded-pill text-secondary" onclick="clearSheet()" data-bs-dismiss="modal">Cancel</button>
                                                    <button type="submit" asp-controller="User" asp-action="AddTimeSheet" class="btn applyButton">Submit</button>
                                                </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>


                            </div>

                        </div>
                        <table class="table ">
                            <tbody>
                                <tr class="  mt-3 mb-3">
                                    <th scope="col"><b>Mission</b> </th>
                                    <th scope="col"> <b>Date</b> </th>
                                    <th scope="col"> <b>Action</b> </th>

                                    <th scope="col"></th>

                                </tr>

                                @foreach (var obj in ViewBag.SheetData)
                                {
                                    if (obj.Time == "")
                                    {
                                        <tr class=" mt-3 mb-3">
                                            <td scope="col">@obj.MissionTitle</td>
                                            <td scope="col">@obj.DateVolunteered</td>
                                            <td scope="col">@obj.Action</td>

                                            <td scope="col">
                                                <button type="button" class="btn p-0" data-bs-toggle="modal" data-bs-target="#exampleModalG-@obj.TimesheetId">
                                                    <i class="bi bi-pencil-square" style="color: coral;"></i>
                                                </button>

                                                <!-- Modal For Edit Goal -->
                                                    <div class="modal fade" id="exampleModalG-@obj.TimesheetId" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">

                                                        <div class="modal-dialog modal-dialog-centered">
                                                            <div class="modal-content">
                                                                <div class="modal-header">
                                                                    <h1 class="modal-title fs-5" id="exampleModalLabel">
                                                                        Please input
                                                                        below Volunteering Goal
                                                                    </h1>
                                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                </div>

                                                                <form method="post">
                                                                    <input type="hidden" value="@obj.TimesheetId" asp-for="TimesheetId" />
                                                                        <div class="modal-body">

                                                                            <label class="mb-1 ">Mission</label>
                                                                            <select asp-for="MissionId" class="form-select" data-bs-toggle="dropdown" aria-placeholder="dropdown" required>
                                                                                <option selected value="@obj.MissionId">@obj.MissionTitle</option>
                                                                                @foreach (var obj1 in ViewBag.MissionList)
                                                                                {
                                                                                    if (obj1.MissionType == "Goal" && obj1.MissionId != obj.MissionId)
                                                                                    {
                                                                                        <option value="@obj1.MissionId">@obj1.Title</option>
                                                                                    }
                                                                                }
                                                                            </select>
                                                                        <label class="mb-1 mt-3">Actions</label>
                                                                        <input type="text" value="@obj.Action" asp-for="Action" class="form-control" placeholder="Enter Actions">
                                                                         <span asp-validation-for="Action" style="color:red"></span>

                                                                        <label class="mb-1 mt-3">
                                                                            Date
                                                                        </label>

                                                                        <div class="form-group">
                                                                            <input type="date" name="sendDateVolunteered" value="@obj.DateVolunteered" id="sDate" class="form-control">
                                                                             <span asp-validation-for="sendDateVolunteered" style="color:red"></span>
                                                                        </div>

                                                                        <label class="mb-1 mt-3" for="exampleFormControlTextarea1">Message</label>
                                                                        <textarea class="form-control" name="Notes" id="exampleFormControlTextarea1"  rows="4" placeholder="Enter your message...">@obj.Notes</textarea>
                                                                            <span asp-validation-for="Notes" style="color:red"></span>
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary bg-transparent border border-2 rounded-pill text-secondary" data-bs-dismiss="modal">Cancel</button>
                                                                        <button type="submit" asp-controller="User" asp-action="EditTimeSheet" class="btn applyButton">Submit</button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>


                                                <button type="button" class="btn p-0" data-bs-toggle="modal" data-bs-target="#exampleModalDelete-@obj.TimesheetId">
                                                    <i class="bi bi-trash ms-3"></i>
                                                </button>

                                                <!-- Modal For Delete Goal -->
                                                    <div class="modal fade" id="exampleModalDelete-@obj.TimesheetId" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">

                                                        <div class="modal-dialog modal-dialog-centered">
                                                            <div class="modal-content">
                                                                <div class="modal-header">
                                                                    <h1 class="modal-title fs-5" id="exampleModalLabel">
                                                                        Are you sure for delete this TimeSheet
                                                                    </h1>
                                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                </div>

                                                                <form method="post">

                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary bg-transparent border border-2 rounded-pill text-secondary" data-bs-dismiss="modal">Cancel</button>
                                                                        <button type="submit" asp-route-id="@obj.TimesheetId" asp-controller="User" asp-action="DeleteTimeSheet" class="btn applyButton">Delete</button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                            </td>
                                        </tr>
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script>

function checkDate() {

    mission_id = document.getElementById("tMission").value;
    var newDate = document.getElementById("tDate").value;

    if (mission_id == 0) {
        $("#missionAlert").text("Please Select Your Mission");
        $("#tDate").val('');
    }
    else {
        $("#missionAlert").text("");
    }
    $.ajax({
        url: '/Home/checkDate',
        type: 'post',
        data: {
            mission_id: mission_id,
            newDate: newDate
        },
        success: function (data) {
            console.log(data)
            if (!data) {
                $("#tDate").val('');
                toastr.error('You can not select the same date')
                $("#dateAlert").text("You can not select the same date");
            } 
        },
        error: function () {
            console.log("Error updating variable");
        }
    })
}

function validDate()
    {
        debugger
        var dateVolunteeredInput = document.getElementById('dateVolunteered').value;
        var dateVolunteered = '2023-04-07'; // Convert server-side datetime to JavaScript date object
       

        dateVolunteeredInput.addEventListener('input', function() {
            
            

            if (dateVolunteered == dateVolunteeredInput) {
                dateVolunteeredInput.setCustomValidity('The date volunteered cannot be the same as the original date.');
            } else {
                dateVolunteeredInput.setCustomValidity('');
            }
            });
       }

function clearSheet() {
    debugger

     @*$('#timeSheetId').val('');*@
    $('#missionId').val(0);
    $('#missionId2').val(0);
    $('#action').val('');
    $('#dateVolunteered').val('');
    $('#dateVolunteered2').val('');
    $('#exampleFormControlTextarea12').val('');
    $('#exampleFormControlTextarea1').val('');
    $('#timeMessage').val('');
    $('#hours').val('');
    $('#minutes').val('');
    $('#exampleFormControlTextarea1').val('');


    var spanElements = document.querySelectorAll("#exampleModal12 span");
    for (var i = 0; i < spanElements.length; i++) {
        spanElements[i].textContent = "";
    }
    var spanElements = document.querySelectorAll("#exampleModal span");
    for (var i = 0; i < spanElements.length; i++) {
        spanElements[i].textContent = "";
    }

}

</script>
